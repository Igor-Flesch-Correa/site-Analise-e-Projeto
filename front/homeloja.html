<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja - Frontend</title>
    <link rel="stylesheet" href="homeloja.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <main>
        <!-- Cabeçalho -->
        <section id="cabeca">
            <div href="/loja" id="lojaLink">
                <img src="/img/logo.svg" alt="logo" id="logoacabeca">
                Casa dos Sabores
            </div>
            <div id="alinhadireita">
                <div id="caixa-pesquisa">
                    <form id="formulario">
                        <input type="hidden" name="modalidade" id="modalidade">
                        <input type="text" name="dscproduto" id="search" placeholder="Pesquisar...">
                        <button id="lupa" type="button" onclick="pesquisar()">&#128269;</button>
                    </form>
                </div>
                <div id="caixaLogin">
                    <div id="login-status"></div>
                </div>
                <a href="/carrinho" id="carrinhoLink">
                    <img id="imagemcarrinho" src="/img/carrinho.svg" alt="Carrinho">
                </a>
                <!--
                <button id="botao-menu" onclick="toggleMenu()">Categorias</button>
                <div id="menu-retratil" style="display: none;">
                    <ul>
                        <button type="button" onclick="filtrarProdutos('')">Todos</button>
                        <button type="button" onclick="filtrarProdutos('1')">Ingressos</button>
                        <button type="button" onclick="filtrarProdutos('2')">Consumíveis</button>
                        <button type="button" onclick="filtrarProdutos('3')">Estacionamento</button>
                        <button type="button" onclick="filtrarProdutos('4')">Complemento</button>
                    </ul>
                </div>
                -->
            </div>
        </section>

        <!-- Propagandas carrossel ----------------------------------------------->
        <section class="carrossel">
            <div class="slides" id="slides">
                <div class="slide"></div>
                <div class="slide"></div>
                <div class="slide">teste</div>
            </div>
            <button class="botao anterior" onclick="voltarSlide()">&#9664;</button>
            <button class="botao proximo" onclick="avancarSlide()">&#9654;</button>
            <div class="indicadores" id="indicadores"></div>
        </section>
        <!-- faixa categorias ------------------------------------------------------------>
        <section class="categorias">
            <div class="titulo-container">
              <h2>Escolha a partir da sua categoria favorita!</h2>
            </div>
            <div class="quadrados-container">
              <div class="quadrado">
                <img src="img/categoria-01.svg" alt="Destaques" class="imagem-svg">
                <p>Destaques</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-02.svg" alt="Pizza" class="imagem-svg">
                <p>Pizza</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-03.svg" alt="Burger" class="imagem-svg">
                <p>Burger</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-04.svg" alt="Massas" class="imagem-svg">
                <p>Massas</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-05.svg" alt="Carnes" class="imagem-svg">
                <p>Carnes</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-06.svg" alt="Peixes" class="imagem-svg">
                <p>Peixes</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-07.svg" alt="Torradas" class="imagem-svg">
                <p>Torradas</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-08.svg" alt="Marmitex" class="imagem-svg">
                <p>Marmitex</p>
              </div>
              <div class="quadrado">
                <img src="img/categoria-09.svg" alt="Doces" class="imagem-svg">
                <p>Doces</p>
              </div>
            </div>
          </section>
          
        <!-- Produtos ------------------------------------------------------------>
        <section id="primeira">
            <section class="caixa" id="produtos"></section>
            <nav id="paginacao"></nav>
        </section>
    </main>

    <!-- Script -->
    <script>
        // Funções de Autenticação usando sessionStorage---------------------------------
        function verificarLogin() {
            const loginStatus = document.getElementById('login-status');
            const user = sessionStorage.getItem('user');

            if (user) {
                const userData = JSON.parse(user);
                loginStatus.innerHTML = `
                    <p>Bem vindo, ${userData.name}</p>
                    <button onclick="logout()">Logout</button>
                `;
            } else {
                loginStatus.innerHTML = `
                    <button onclick="exibirLoginForm()">Login</button>
                `;
            }
        }

        function exibirLoginForm() {
            const username = prompt("Digite seu nome para login:", "Usuário");
            if (username) {
                const userData = { name: username };
                sessionStorage.setItem('user', JSON.stringify(userData));
                verificarLogin();
            }
        }

        function logout() {
            sessionStorage.removeItem('user');
            verificarLogin();
        }
        // fim funçoes de login-----------------------------------------------
        // carrossel de propagandas ---------------------------------------------------

        // Variáveis globais
        const slides = document.getElementById('slides');
        const totalSlides = slides.children.length;
        let slideAtual = 0;

        // Função para atualizar o slide
        function mostrarSlide(index) {
            if (index < 0) {
                slideAtual = totalSlides - 1;
            } else if (index >= totalSlides) {
                slideAtual = 0;
            } else {
                slideAtual = index;
            }
            slides.style.transform = `translateX(-${slideAtual * 100}%)`;
            atualizarIndicadores();
        }

        // Funções para avançar e voltar
        function avancarSlide() {
            mostrarSlide(slideAtual + 1);
        }

        function voltarSlide() {
            mostrarSlide(slideAtual - 1);
        }

        // Troca automática dos slides
        setInterval(() => {
            avancarSlide();
        }, 3000);

        // Criar indicadores
        const indicadoresContainer = document.getElementById('indicadores');
        for (let i = 0; i < totalSlides; i++) {
            const indicador = document.createElement('div');
            indicador.classList.add('indicador');
            indicador.addEventListener('click', () => mostrarSlide(i));
            indicadoresContainer.appendChild(indicador);
        }

        // Atualizar indicadores ativos
        function atualizarIndicadores() {
            const indicadores = document.querySelectorAll('.indicador');
            indicadores.forEach((indicador, index) => {
                indicador.classList.toggle('ativo', index === slideAtual);
            });
        }

        // Inicializar
        mostrarSlide(0);

// Função para carregar produtos
async function fetchProdutos(page = 1, limit = 10, category ='Lanche' ) {
    try {
        // Construindo a URL com os parâmetros
        const apiUrl = `https://casadossabores.yjwxjj.easypanel.host/products?page=${page}&limit=${limit}&category=${category}`;

        //teste
        console.log("Enviando requisição:");
        console.log({
            url: apiUrl,
            method: 'GET',
            
            headers: {
                'Accept': '*/*'
            },
        });

        //fim teste
        
        // Fazendo a requisição à API
        const response = await fetch(apiUrl, {
            method: 'GET', // Método HTTP
            
            headers: {
                'Accept': '*/*', // Cabeçalho para aceitar qualquer tipo de resposta
            },
        });
        if (!response.ok) throw new Error(`Erro ao buscar produtos: ${response.statusText}`);
        
        const data = await response.json();

        // Mostrar resposta JSON em um popup
        alert("Resposta recebida com sucesso!");
        alert(`Resposta JSON: ${JSON.stringify(data, null, 2)}`);

        // Renderizar produtos no container
        renderizarProdutos(data.data);
        configurarPaginacao(data.totalPages, parseInt(data.page));
    } catch (error) {
        console.error(error);

        // Renderizar caixas de produtos vazios em caso de erro
        renderizarProdutosVazios(6);
        alert("Erro ao carregar os produtos. Exibindo placeholders.");
    }
}

    // Função para renderizar produtos
    function renderizarProdutos(produtos) {
        const produtosContainer = document.getElementById('produtos');
        produtosContainer.innerHTML = produtos.map(produto => `
            <div class="produto" id="produto-${produto.id}">
                <div class="imagem">
                    <img src="${produto.imageUrl}" alt="${produto.name}" onerror="this.src='/img/logo.svg';">
                </div>
                <div class="informacoes">
                    <h3>${produto.name}</h3>
                    <p>${produto.description}</p>
                    <p>Preço: R$ ${produto.price.toFixed(2)}</p>
                    <button class="botao-add-carrinho" onclick="addToCart(${produto.id})">Add ao Carrinho +</button>
                </div>
            </div>
        `).join('');
    }

    // Função para renderizar produtos vazios (placeholders)
    function renderizarProdutosVazios(quantidade) {
        const produtosContainer = document.getElementById('produtos');
        produtosContainer.innerHTML = Array.from({ length: quantidade }).map((_, index) => `
            <div class="produto vazio" id="placeholder-${index}">
                <div class="imagem">
                    <img src="/img/placeholder.svg" alt="Placeholder">
                </div>
                <div class="informacoes">
                    <h3>Produto Indisponível</h3>
                    <p>Descrição não disponível</p>
                    <p>Preço: R$ 0,00</p>
                    <button class="botao-add-carrinho">Add ao Carrinho +</button>
                </div>
            </div>
        `).join('');
    }

    // Função para configurar paginação
    function configurarPaginacao(totalPaginas, paginaAtual) {
        const paginacaoContainer = document.getElementById('paginacao');
        paginacaoContainer.innerHTML = `
            <button onclick="fetchProdutos(1)">&lt;&lt;</button>
            <button onclick="fetchProdutos(${Math.max(1, paginaAtual - 1)})">&lt;</button>
            ${Array.from({ length: totalPaginas }, (_, i) => `
                <button onclick="fetchProdutos(${i + 1})" ${i + 1 === paginaAtual ? 'disabled' : ''}>${i + 1}</button>
            `).join('')}
            <button onclick="fetchProdutos(${Math.min(totalPaginas, paginaAtual + 1)})">&gt;</button>
            <button onclick="fetchProdutos(${totalPaginas})">&gt;&gt;</button>
        `;
    }

    // Função para adicionar ao carrinho
    function addToCart(idProduto) {
        alert(`Produto ${idProduto} adicionado ao carrinho!`);
    }

    // Função para filtrar produtos por categoria
    function filtrarProdutos(categoria) {
        fetchProdutos(1, 10, categoria);
    }

    // Função para pesquisar produtos
    function pesquisar() {
        const query = document.getElementById('search').value;
        fetchProdutos(1, 10, query);
    }

    // Inicialização
    document.addEventListener('DOMContentLoaded', () => {
        fetchProdutos(); // Carregar produtos sem categoria inicialmente


        // Adicionar eventos para os botões de categoria
        document.querySelectorAll('.botaoCategoria').forEach(botao => {
            botao.addEventListener('click', () => filtrarProdutos(botao.dataset.categoria));
        });
        verificarLogin(); // chama função login ao carregar pag
    });
</script>
</body>
</html>
